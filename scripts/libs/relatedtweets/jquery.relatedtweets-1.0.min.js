/* 	Realtime Related Tweets Bar v1.0
	Blog : http://www.moretechtips.net
	Project: http://code.google.com/p/realtime-related-tweets-bar/
	Copyright 2009 [Mike @ moretechtips.net] 
	Licensed under the Apache License, Version 2.0 
	(the "License"); you may not use this file except in compliance with the License. 
	You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0 
*/

(function(c){c.fn.relatedTweets=function(k){var m={debug:0,query:"",default_query:"",realtime:1,status:0,lang:"en",n:10,max_tags:5,or_tags:1,show_avatar:1,show_author:1,show_date:1,show_source:1,image_width:48,from_users:"",to_users:"",at_users:"",links_only:0,geocode:"",stay_time:5E3,enter_time:300,exit_time:200,animate:"opacity"},k=c.extend({},m,k);return this.each(function(){var i=c(this),h=0,g=null,n=0,f=-1,j=0,l=!1,o={},a=k;if(i.attr("options")){try{a=eval("("+i.attr("options")+")")}catch(s){a.debug&& i.html('<b style="color:red">'+s+"</b>");return}a=c.extend({},m,a)}var v=function(b){if(!b.results||!b.max_id)a.debug&&i.html('<b style="color:red">Error:'+(b.error?b.error:"unkown")+"</b>");else{var e=b.results;0<b.max_id&&(n=b.max_id);if(0==j){if(0==e.length)return;h=e.length;b=c('<div class="rrt-inner"></div>').appendTo(i.html(""));g=c("<ul></ul>").appendTo(b)}j++;for(b=e.length-1;0<=b;b--){var d=e[b];c('<li style="display:none;">'+(a.show_avatar?'<span class="rrt-author-img"><a href="http://twitter.com/'+ d.from_user+'" title="'+d.from_user+'"><img src="'+d.profile_image_url+'" height="'+a.image_width+'" width="'+a.image_width+'" border="0"/></a></span>':"")+'<span class="rrt-body">'+(a.show_author?'<strong><a href="http://twitter.com/'+d.from_user+'" title="'+d.from_user+'">'+d.from_user+"</a></strong>":"")+'<span class="rrt-content">'+t(d.text)+'</span><span class="rrt-meta">'+(a.show_date?'<a class="rrt-date" href="http://twitter.com/'+d.from_user+"/status/"+d.id_str+'">'+u(d.created_at)+"</a>": "")+(a.show_source?'<span class="rrt-source"> from '+d.source.replace(/&lt;/gi,"<").replace(/&gt;/gi,">").replace(/&quot;/gi,'"')+"</span>":"")+"</span></span></li>").appendTo(g)}1<j&&e.length&&(l=!0);1==j&&p()}},p=function(){-1<f?c("li",g).eq(f).fadeOut(a.exit_time,q):q()},q=function(){if(l){var b=c("li",g).size();b>a.n?(c("li:lt("+(b-a.n)+")",g).remove(),h=a.n):h=b;l=!1}f++;f>=h&&(f=0);o[a.animate]="show";c("li",g).eq(f).animate(o,a.enter_time,"linear",w);f+1>=h&&a.realtime&&r()},w=function(){c("li", g).eq(f).animate({opacity:1},a.stay_time,"linear",p)},t=function(a){return a.replace(/\bhttps?\:\/\/\S+/gi,function(a){var b="",a=a.replace(/(\.*|\?*|\!*)$/,function(a,e){b=e;return""});return'<a class="rrt-link" href="'+a+'">'+(25<a.length?a.substr(0,24)+"...":a)+"</a>"+b}).replace(/\B\@([A-Z0-9_]{1,15})/gi,'@<a class="rrt-at" href="http://twitter.com/$1">$1</a>').replace(/\B\#([A-Z0-9_]+)/gi,'<a class="rrt-hashtag" href="http://search.twitter.com/search?q=%23$1">#$1</a>')},u=function(a){var e=new Date, d=new Date;e.setTime(Date.parse(a));var c=d.getDate(),f=d.getMonth()+1,g=d.getFullYear(),i=d.getHours(),a=d.getMinutes(),d=d.getSeconds(),h=e.getDate(),j=e.getMonth()+1,k=e.getFullYear(),l=e.getHours(),m=e.getMinutes(),e=e.getSeconds();if(k==g&&j==f&&h==c){c=i-l;if(0<c)return c+" hour"+(1<c?"s":"")+" ago";a-=m;if(0<a)return a+" minute"+(1<a?"s":"")+" ago";a=d-e;return a+" second"+(1<a?"s":"")+" ago"}return j+"/"+h+"/"+k},r=function(){var b={lang:a.lang,q:a.query,rpp:a.n,since_id:n};a.geocode&&(b.geocode= a.geocode);c.ajax({url:"http://search.twitter.com/search.json",data:b,success:v,dataType:"jsonp"})};(function(){var b=[];!a.query&&!a.status&&c('a[rel="tag"]:lt('+a.max_tags+")").each(function(){var a=c.trim(c(this).text().replace(/\n/g,""));-1==c.inArray(a,b)&&(b[b.length]=a)});0<b.length&&(a.query=b.join(a.or_tags?" OR ":" "));a.query||(a.query=a.default_query);a.from_users&&(a.query+=" from:"+a.from_users.replace(/\s/g,"").replace(/,/g," OR from:"));a.to_users&&(a.query+=" to:"+a.to_users.replace(/\s/g, "").replace(/,/g," OR to:"));a.at_users&&(a.query+=" @"+a.at_users.replace(/\s/g,"").replace(/,/g," OR @"));a.links_only&&(a.query+=" filter:links");r()})()})}})(jQuery);jQuery(document).ready(function(){jQuery("div.related-tweets").relatedTweets()});